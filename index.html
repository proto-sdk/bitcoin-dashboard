<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/x-icon" href="/bitcoin-dashboard/proto_favicon.ico">
    <link rel="icon" type="image/png" href="/bitcoin-dashboard/proto_logo.png">
    <link rel="icon" type="image/png" href="/bitcoin-dashboard/proto_favicon_32.png">
    <link rel="shortcut icon" type="image/x-icon" href="/bitcoin-dashboard/proto_favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Network Statistics</title>
    <style>
        /* ... (keeping existing styles) ... */
        
        /* Interval card specific styles */
        .interval-details {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
        }
        
        .interval-source {
            font-size: 11px;
            color: #666;
            margin-top: 2px;
        }
        
        /* Add animation for updating values */
        @keyframes highlight {
            0% { background-color: rgba(255, 107, 53, 0.2); }
            100% { background-color: transparent; }
        }
        
        .highlight {
            animation: highlight 1s ease-out;
        }
        
        /* Add loading animation */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .loading {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <!-- ... (keeping existing header and structure) ... -->
    
    <div class="stats-grid">
        <!-- ... (keeping other stat cards) ... -->
        
        <!-- Updated Interval Card -->
        <div class="stat-card" id="intervalCard" onclick="window.open('https://blockchain.info/q/interval', '_blank')">
            <div class="status-indicator"></div>
            <span class="stat-icon price-green">⏲️</span>
            <div class="stat-value" id="interval">Loading...</div>
            <div class="stat-label">Block Interval</div>
            <div class="interval-details" id="intervalDetails"></div>
            <div class="interval-source" id="intervalSource"></div>
            <div class="tooltip">Current average time between blocks</div>
        </div>
        
        <!-- ... (keeping other stat cards) ... -->
    </div>

    <!-- ... (keeping footer) ... -->

    <script>
        // Constants
        const TARGET_BLOCK_TIME = 600; // 10 minutes in seconds
        const UPDATE_INTERVAL = 30000; // Update every 30 seconds
        
        // Store last update time
        let lastUpdateTime = 0;
        
        async function fetchBlockInterval() {
            try {
                // Use blockchain.info's direct interval API
                const response = await fetch('https://blockchain.info/q/interval');
                if (!response.ok) {
                    throw new Error('Failed to fetch interval');
                }
                
                const intervalText = await response.text();
                const interval = parseFloat(intervalText);
                
                if (isNaN(interval) || interval <= 0) {
                    throw new Error('Invalid interval data');
                }
                
                // Update the UI
                const minutes = Math.floor(interval / 60);
                const seconds = Math.floor(interval % 60);
                
                const intervalElement = document.getElementById('interval');
                const newText = `${minutes}m ${seconds}s`;
                
                if (intervalElement.textContent !== newText) {
                    intervalElement.textContent = newText;
                    intervalElement.classList.remove('highlight');
                    void intervalElement.offsetWidth; // Trigger reflow
                    intervalElement.classList.add('highlight');
                }
                
                // Calculate and display deviation from target
                const deviation = ((interval - TARGET_BLOCK_TIME) / TARGET_BLOCK_TIME * 100).toFixed(1);
                const deviationText = deviation > 0 ? `+${deviation}%` : `${deviation}%`;
                
                // Update interval details
                document.getElementById('intervalDetails').textContent = 
                    `${deviationText} from target (10m)`;
                
                // Update source information
                document.getElementById('intervalSource').textContent = 
                    `Data from blockchain.info/q/interval`;
                
                // Store the interval for other calculations
                window.currentInterval = interval;
                lastUpdateTime = Date.now();
                
                // Update status indicator
                const statusIndicator = document.querySelector('#intervalCard .status-indicator');
                statusIndicator.style.backgroundColor = '#4CAF50'; // Green for success
                
                return true;
            } catch (error) {
                console.error('Error fetching interval data:', error);
                
                // Try backup API - blockchain.com explorer API
                try {
                    const response = await fetch('https://api.blockchain.com/v3/blocks/latest');
                    if (!response.ok) {
                        throw new Error('Failed to fetch from backup API');
                    }
                    
                    const data = await response.json();
                    if (data.timestamp) {
                        // Use a 10-minute default if we can't get exact interval
                        const interval = 600;
                        const minutes = Math.floor(interval / 60);
                        const seconds = Math.floor(interval % 60);
                        
                        document.getElementById('interval').textContent = `${minutes}m ${seconds}s`;
                        document.getElementById('intervalDetails').textContent = 'Using estimated value';
                        document.getElementById('intervalSource').textContent = 'Backup source: blockchain.com';
                        
                        window.currentInterval = interval;
                        return true;
                    }
                } catch (backupError) {
                    console.error('Backup API also failed:', backupError);
                }
                
                // Update UI to show error state
                document.getElementById('interval').textContent = 'Error';
                document.getElementById('intervalDetails').textContent = 'Failed to fetch interval data';
                document.getElementById('intervalSource').textContent = 'Please try refreshing';
                
                // Update status indicator
                const statusIndicator = document.querySelector('#intervalCard .status-indicator');
                statusIndicator.style.backgroundColor = '#FF6B6B'; // Red for error
                
                return false;
            }
        }
        
        // Update the main fetchData function
        async function fetchData() {
            try {
                // Reset the counter
                startTime = Date.now();
                updateCounter();
                
                // Fetch interval data first
                await fetchBlockInterval();
                
                // ... (rest of the existing fetchData function) ...
                
            } catch (error) {
                console.error('Error in fetchData:', error);
                // ... (existing error handling) ...
            }
        }
        
        // Set up auto-update specifically for interval
        setInterval(async () => {
            if (Date.now() - lastUpdateTime >= UPDATE_INTERVAL) {
                await fetchBlockInterval();
            }
        }, UPDATE_INTERVAL);
        
        // ... (rest of the existing script) ...
    </script>
</body>
</html>
